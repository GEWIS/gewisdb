{
	"image": "mcr.microsoft.com/devcontainers/php:8.3",
	"customizations": {
		"vscode": {
      		"extensions": [
				"getpsalm.psalm-vscode-plugin",
				"swordev.phpstan",
				"bmewburn.vscode-intelephense-client",
				"ms-vscode.makefile-tools",
				"ms-azuretools.vscode-docker",
				"wongjn.php-sniffer",
				"ms-vscode-remote.remote-containers"
			],
			"settings": {
				"makefile.configureOnOpen": false,
				"phpSniffer.run": "onType",
				"phpSniffer.autoDetect": true,
				"[php]": {
					"editor.defaultFormatter": "wongjn.php-sniffer"
				}
			}
    	},
		"codespaces": {
			"repositories": {
				"GEWIS/gewisdb": {
					"permissions": {
						"metadata": "read",
						"contents": "write",
						"deployments": "read"
					}
				},
				"GEWIS/gewisweb": {
					"permissions": {
						"metadata": "read",
						"contents": "read",
						"deployments": "read"
					}
				}
			}
		}
	},
	"features": {
		"ghcr.io/devcontainers/features/docker-outside-of-docker:1": {
			"moby": true,
			"installDockerBuildx": true,
			"version": "28.3.0", // To avoid https://github.com/docker/buildx/issues/3328; can be removed 2025-09
			"mobyBuildxVersion": "0.25.0", // To avoid https://github.com/docker/buildx/issues/3328; can be removed 2025-09
			"dockerDashComposeVersion": "v2"
		},
		"./local-features/gewisdb-php-opcache": {
			"version": "latest"
		},
		"./local-features/gewisdb-php-intl": {
			"version": "latest"
		}
	},
	"remoteUser": "vscode",
	"postCreateCommand": {
		"build": "cp .env.dist .env",
		"noXdebug": "sudo rm -f /usr/local/etc/php/conf.d/xdebug.ini"
	},
	"postStartCommand": {
		"runGewisDb": "(make builddev && docker compose build && make rundev && make getvendordir); true"
	},
	"waitFor": "postCreateCommand",
	//"postAttachCommand": "",
	"forwardPorts": [
		80,
		8080,
		8021,
		8025
	],
	"portsAttributes": {
		"80": {
			"label": "GEWISDB Web interface",
			"onAutoForward": "openBrowserOnce",
			"protocol": "http"
		},
		"8080": {
			"label": "PGAdmin",
			"onAutoForward": "openBrowserOnce",
			"protocol": "http"
		},
		"8021": {
			"label": "Mailman web interface",
			"onAutoForward": "silent",
			"protocol": "http"
		},
		"8025": {
			"label": "mailhog",
			"onAutoForward": "silent",
			"protocol": "http"
		}
	},
	"shutdownAction": "stopContainer",
	"hostRequirements": {
		"cpus": 2,
		"memory": "4gb",
		"gpu": false,
		"storage": "25gb"
	}
}